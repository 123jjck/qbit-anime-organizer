# qbit_anime_organize
Скрипт в автоматическом режиме переименовывает и перемещает скачанные сериалы в собственную папку. Полезно в первую очередь для тех, кто держит свой домашний медиасервер, например Plex
## Принцип работы
Данный скрипт рассчитан на использование вместе с торрент-клиентом [qBittorrent](https://github.com/qbittorrent/qBittorrent).  Он подойдёт только для тех торрентов, в которых серии находятся В ПАПКЕ и имеют вшитые субтитры и озвучку!
1. После завершения загрузки qBittorrent вызывает скрипт, передавая хэш торрента в аргументах
2. Скрипт убеждается, что загрузка точно завершена, и что торрент имеет одну из разрешенных категорий (`default.qbit.allowed_categories` в `config.json`)
3. Если в папке с сериями есть незавершенные файлы (например, если вы во время загрузки передумали и сняли галочки с каких-либо файлов в торрент клиенте), скрипт их удаляет
4. Если торрент содержит в себе файлы, скачанные с сервиса AniLibria и имеют характерный нейминг (т.е номер серии в квадратных скобках (`[01]` и т.п), название серий приводится в стандартный вид: `Ijiranaide_Nagatoro-san_2nd_Attack_[01]_[AniLibria_TV]_[WEBRip_1080p_HEVC].mkv` => `Ijiranaide_Nagatoro-san_2nd_Attack 01 [WEBRip_1080p_HEVC].mkv`. Данный шаг необходим для правильного распознавания серий Plex медиасервером
5. Если включено автоматическое перемещение серий (`series.moving`), скрипт действует по следующему алгоритму:
* Если отключен ручной нейминг и при этом торрент-файл скачан с AniLibria:
	1. Убираем из названия папки с сериями всё лишнее и используем это в качестве названия папки сериала
	2. Если включён парсинг названий с AniLibria (`api.enable_fetching`), пытаемся достать при помощи API название сериала
* Если включён ручной нейминг, в качестве названия папки сериала используется название **ТОРРЕНТА**.
6. Если в названии **ТОРРЕНТА** указан сезон в формате `[Sномер]` (например: `[S1]`, `[S01]` и т.д.), переименовываем папку с сериями в "Season номер" (для корректного распознавания сезона Plex медиасервером). 
Если нет, используем значение сезона по-умолчанию (`series.moving.default_season`)
7. Перемещаем папку торрента в указанный путь (`series.moving.destination`)
	* Таким образом, получается идеальная структура файлов: `/путь/к/папке/с/сериалами/Название Сериала/Season номер/серии.mkv`, которую подхватывает Plex медиасервер. Так как все процедуры происходят при помощи API qBittorrent'а, сохраняется возможность дальнейшей раздачи этих файлов.
